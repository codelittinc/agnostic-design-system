# AY Design Library

## ðŸ‘‹ Intro


This is the Avison Young's React implementation of the design system. It offers a set of components to speedup the front end development of web applications. 
 
## Summary
- [Getting started](#getting-started)
  - [Running the style guide](#running-the-style-guide)
     - [Requirements](#requirements)
     - [With Docker](#with-docker)
     - [Without Docker](#without-docker)
  - [How this project is structured](#how-this-project-is-structured)
- [Scripts](#scripts)
  - [Shell Scripts](#shell-scripts)
- [Continuous Integration](#continuous-integration)
  - [Introduction](#ci-intoduction)
  - [Create a project](#create-a-project)
  - [Configuration](#ci-configuration)
    - [Create build in Azure DevOps](#create-build-in-azure-devops)
    - [Test configuration](#test-configuration)
    - [Forcing test build to run on PRs](#forcing-test-build-to-run-on-prs)
- [Publish a new version](#publish-a-new-version)

## Getting started

### Running the project

#### Requirements
See the [authentication](./docs/AUTHENTICATION.md) instructions before you continue.

#### With Docker  

1. Clone the project.
2. Run `cp .env.example .env` and add the environment variables to it
3. Run `sh scripts/dev.sh` to start the Docker container
4. Access http://localhost:6060

#### Without Docker

1. Clone the project
2. Run `cp .env.example .env` and add the environment variables to it
2. Run `npm install` to install all dependencies
3. Start the dev server `npm run start:dev`  
4. Access http://localhost:6060

### How this project is structured

Basic rules:

1. All components live in the `src/components` folder.
2. Only components that will be exported should be directly child of `src/components`, any component for internal use should be inside the component using it.
3. All components being exported should have a `README.md` file inside its folder, it should display examples of how to use the component.


The full folder structure of this library is explained below:

| Name                                             | Description                                                                           |
| ------------------------------------------------ | --------------------------------------------------------------------------------------|
| **.vscode**                                      | Contains VS Code specific settings.                                                   |
| **dist**                                         | Contains the distributable from the Webpack build.                                    |
| **src**                                          | Contains the source code.                                                             |
| **src/assets**                                   | Contains the assets used by the components (images, general stylesheets).             |
| [**src/components**](src/components/README.md)   | Contains the components based on the Design System                                    |
| **storybook-static**                             | Build files generated by the style guide tool.                                        |
| [**tests**](tests/README.md)                     | Contains the tests                                                                    |

## Scripts

We have a set of useful Shell scripts in this project in order to speedup the development.

### Shell Scripts
- `scripts/buildDocs.sh`: Builds the Docker image with the style guide docs.
- `scripts/dockerTagDocs.sh`: Runs the buildDocs process and sends the image to Docker Hub.
- `scripts/dev.sh`: Runs the Docker container and after starts the app.

## Continuous Integration

For continuous integration we have opted to use Azure Pipelines,
the reason for it is that we are going to use all azure services and the integration is very smooth.

### <a name="ci-intoduction"/> Introduction

**Azure Pipelines** is a integration provided directly into Github that creates a CI/CD environment for Builds/Releases in each case.
It provides a easy and friendly UI to crete builds, track their progress, issues and understand what is being released.
After installing Azure Pipelines on the repository we are going to be redirected to a **Azure DevOps portal**, this will be where we are going to manage everything for that user.

### Create a project

To start with continuous integration, the first thing you need to do is create a new project on your Azure DevOps account,
and after you need to enable the Pipelines service:
1. Go to https://dev.azure.com/<organization name>
2. Create a new private project.

Now that we have the project created, we need to enable the Pipelines service on it:
3. Go to the Project Settings page.
4. Under the Services section enable the Pipelines service.

### <a name="ci-configuration"/> Configuration

Even though configurations can be done using the UI provided by **Azure DevOps**, we opt to use yml files, like `test-pipeline.yml`.
The reasoning is to track the configuration and easily migrate to any other repository or project.
Also we can provide different configurations for different providers and the base project will be capable of be deployed to any of the available providers.

#### Create build in Azure DevOps

When creating a new build, we can import settings from a **yml** file, use the `test-pipeline.yml` as the config file, and it will use it to provide the build steps.

Under the Pipeline menu you can create a _new build pipeline_. This process is done with 4 steps:
1. You need to connect Azure to our Github repository. So, select the **Github YAML** option.
2. Select this project's repository.
3. Select the option: **Existing Azure Pipelines YAML file**. It will open a form where you need to select the `test-piline.yml` from the git repository.
4. Add the ENV variables to the pipeline.
5. Test the pipeline and finish.

#### Test configuration

For the test steps we have provided a basic node js testing flow.
The project will be built using nodejs (currently docker test are not supported) and validate that the build is working as expected.
In the case of environment variables, for security reasons, it should be stored on the **Azure DevOps portal** to avoid having those variables in plain text in the repository.

#### Forcing test build to run on PRs

Before merging a PR we need to ensure that the test build ran successfully. We can achieve this by creating a branch rule in the Github repository.
This will enforce that each time a PR is created, the tests will run and if are not run succesfully it can't be merged.

1. Go to your repository settings.
2. Create a new _Branch Rule_, this rule should apply to all branches, so the pattern should be `*`.
3. Check the **Require status checks to pass before merging**, and select the test build.

## Publish a new version

In order to publish a new version of this package take a look [here](./docs/PUBLISH.md).
